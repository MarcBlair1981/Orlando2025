<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orlando Family Trip Planner</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- IMPORTANT: Load external config for GitHub Pages deployment -->
    <script src="firebase-config.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase Compat SDKs (Namespace) - Works with file:// protocol -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- GLOBAL ERROR HANDLER -->
    <script>
        window.onerror = function (msg, url, line, col, error) {
            const statusDiv = document.getElementById('app-load-status');
            if (statusDiv) {
                statusDiv.innerHTML = `<span class="text-red-600 font-bold">ERROR: ${msg} <br> at ${url}:${line}:${col}</span>`;
                statusDiv.classList.remove('text-blue-600');
                statusDiv.classList.add('text-red-600', 'bg-red-100', 'p-2', 'rounded');
            }
            return false;
        };

        window.addEventListener('DOMContentLoaded', () => {
            if (!window.firebase) {
                const statusDiv = document.getElementById('app-load-status');
                if (statusDiv) statusDiv.textContent += " (Warning: Firebase SDK not loaded)";
            }
        });
    </script>
</head>

<body>

    <div class="max-w-7xl mx-auto p-4 md:p-8 bg-white shadow-xl rounded-xl mt-4 mb-8 border-t-8 border-red-700">

        <!-- HEADER & FAMILY INFO -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-red-700 mb-2 tracking-tight">
                Blair/Rosenberg Christmas Orlando 2025 üè∞
            </h1>
            <p class="text-xl text-gray-600">It's the most wonderful time of the year!</p>

            <!-- FAMILY PHOTO SECTION -->
            <div class="mt-6 flex justify-center">
                <img src="family_photo.png" alt="The Blair & Rosenberg Family"
                    class="rounded-xl shadow-2xl max-w-full h-auto md:max-w-2xl border-4 border-white bg-gray-200"
                    onerror="this.style.display='none'">
            </div>

            <!-- HANUKKAH COUNTDOWN -->
            <div class="mt-8 max-w-3xl mx-auto">
                <div
                    class="bg-gradient-to-r from-blue-900 to-blue-600 rounded-xl shadow-lg p-1 border-4 border-yellow-400">
                    <div class="bg-blue-800 rounded-lg p-4 text-white text-center">
                        <h3
                            class="text-lg md:text-xl font-bold text-blue-200 uppercase tracking-widest mb-2 flex justify-center items-center gap-2">
                            <span>üïé</span> Time until we fly! <span>‚úàÔ∏è</span>
                        </h3>
                        <div id="countdown-timer" class="grid grid-cols-4 gap-2 md:gap-4 text-center">
                            <div class="bg-blue-900/50 rounded p-2">
                                <span class="block text-2xl md:text-4xl font-bold font-mono" id="cd-days">--</span>
                                <span class="text-xs text-blue-300 uppercase">Days</span>
                            </div>
                            <div class="bg-blue-900/50 rounded p-2">
                                <span class="block text-2xl md:text-4xl font-bold font-mono" id="cd-hours">--</span>
                                <span class="text-xs text-blue-300 uppercase">Hours</span>
                            </div>
                            <div class="bg-blue-900/50 rounded p-2">
                                <span class="block text-2xl md:text-4xl font-bold font-mono" id="cd-minutes">--</span>
                                <span class="text-xs text-blue-300 uppercase">Mins</span>
                            </div>
                            <div class="bg-blue-900/50 rounded p-2">
                                <span class="block text-2xl md:text-4xl font-bold font-mono" id="cd-seconds">--</span>
                                <span class="text-xs text-blue-300 uppercase">Secs</span>
                            </div>
                        </div>
                        <p class="mt-2 text-xs text-blue-300">Target: Dec 20, 2025 @ 12:00 UTC</p>
                    </div>
                </div>
            </div>

            <div class="mt-4 p-2 bg-white inline-block rounded shadow-sm">
                <div id="auth-status" class="text-sm text-green-600 font-semibold">Initializing...</div>
                <div class="text-xs text-gray-400 mt-1">User ID: <span id="current-user-id">...</span></div>
            </div>
            <!-- DEBUGGING MESSAGE -->
            <div id="app-load-status" class="mt-2 text-xs text-blue-600 font-medium">Waiting for window load...</div>
        </header>

        <!-- NAVIGATION TABS -->
        <div class="flex flex-wrap justify-center border-b border-gray-200 mb-6">
            <button onclick="showTab('dashboard')"
                class="tab-button active py-3 px-4 md:px-6 text-lg font-medium text-gray-600 hover:text-red-600 rounded-t-lg"
                data-tab="dashboard">Dashboard</button>
            <button onclick="showTab('itinerary')"
                class="tab-button py-3 px-4 md:px-6 text-lg font-medium text-gray-600 hover:text-red-600 rounded-t-lg"
                data-tab="itinerary">Trip Itinerary</button>
            <button onclick="showTab('packing')"
                class="tab-button py-3 px-4 md:px-6 text-lg font-medium text-gray-600 hover:text-red-600 rounded-t-lg"
                data-tab="packing">Packing List</button>
            <button onclick="showTab('chat')"
                class="tab-button py-3 px-4 md:px-6 text-lg font-medium text-gray-600 hover:text-red-600 rounded-t-lg"
                data-tab="chat">Group Chat & Ideas</button>
            <button onclick="showTab('gpt')"
                class="tab-button py-3 px-4 md:px-6 text-lg font-medium text-gray-600 hover:text-red-600 rounded-t-lg"
                data-tab="gpt">Mickey's Planning Pal GPT</button>
        </div>

        <!-- TAB CONTENT -->

        <!-- 1. DASHBOARD TAB -->
        <div id="tab-dashboard" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Family/Disney Visuals & Links -->
                <div class="col-span-1 lg:col-span-2 space-y-6">
                    <div class="bg-yellow-50 p-6 rounded-xl shadow-md border-l-4 border-yellow-400">
                        <h2 class="text-2xl font-bold text-gray-800 mb-3 flex items-center">
                            Welcome Family! üë®‚Äçüë©‚Äçüëß‚Äçüë¶
                        </h2>
                        <div class="flex flex-wrap gap-4 items-start">
                            <div class="text-4xl space-x-2 pt-2">
                                üê≠ üè∞ üåü ‚ú® üöÄ üëë
                            </div>
                            <p class="text-gray-700 mt-2 text-sm">
                                This is our shared hub! We are 12 people (6 adults, 6 kids/young adults) traveling
                                together. Let's make this the best Christmas ever!
                            </p>
                        </div>
                    </div>

                    <!-- Hotel Info -->
                    <div class="bg-blue-50 p-6 rounded-xl shadow-md border-l-4 border-blue-400">
                        <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-blue-600"
                                viewBox="0 0 20 20" fill="currentColor">
                                <path
                                    d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707l-.707-.707V8a6 6 0 00-6-6zm-6 8.28V8a6 6 0 1112 0v2.28a1 1 0 00.27.67l.73.73H3l.73-.73a1 1 0 00.27-.67zM10 18a3 3 0 100-6 3 3 0 000 6z" />
                            </svg>
                            Our Home Base: Waldorf Astoria Orlando
                        </h3>
                        <ul class="text-sm space-y-2 text-gray-700 list-disc list-inside">
                            <li>**Official Disney Hotel:** Offers complimentary luxury coach transportation to all
                                Disney parks and Disney Springs.</li>
                            <li>**Amenities:** Access to two pools, luxe private cabanas, a zero-entry pool (great for
                                Riley, 1), and use of the lazy river/water slide at the adjacent Signia by Hilton Bonnet
                                Creek.</li>
                            <li>**Kids Club:** WA Kids Club (ages 5-12, perfect for Billie, 10, Mimi, 6, Joey, 5, and
                                Emma, 7) offers supervised evening activities.</li>
                            <li>**Dining:** Multiple options including Oscar's Brasserie (great breakfast buffet), Bull
                                & Bear Steakhouse, and poolside Aquamarine.</li>
                        </ul>
                    </div>
                </div>

                <!-- Flight Info & Links Column -->
                <div class="col-span-1 space-y-6">
                    <div class="bg-green-50 p-6 rounded-xl shadow-md border-l-4 border-green-400">
                        <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
                            ‚úàÔ∏è Flights Status
                        </h3>
                        <div id="flights-info" class="space-y-3 text-sm">
                            <div class="flex justify-between items-center p-2 bg-white rounded-lg shadow-sm">
                                <span class="font-semibold text-gray-700">Marc & Melissa's Crew:</span>
                                <span class="text-green-600 font-bold">Confirmed - Dec 21st</span>
                            </div>
                            <div class="flex justify-between items-center p-2 bg-white rounded-lg shadow-sm">
                                <span class="font-semibold text-gray-700">Daniel & Jessica's Crew:</span>
                                <span class="text-red-600 font-bold">TBD - Need to Book!</span>
                            </div>
                            <div class="flex justify-between items-center p-2 bg-white rounded-lg shadow-sm">
                                <span class="font-semibold text-gray-700">John, Lindsay & Ricky:</span>
                                <span class="text-green-600 font-bold">Confirmed - Dec 20th</span>
                            </div>
                        </div>
                    </div>

                    <!-- External Links -->
                    <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                        <h3 class="text-xl font-bold text-gray-800 mb-3 flex items-center">
                            üîó Key Links
                        </h3>
                        <ul class="space-y-2 text-sm">
                            <li><a href="https://disneyworld.disney.go.com/" target="_blank"
                                    class="text-blue-600 hover:text-blue-800 font-medium">Official Walt Disney World
                                    Site</a></li>
                            <li><a href="https://waldorfastoriaorlando.com/" target="_blank"
                                    class="text-blue-600 hover:text-blue-800 font-medium">Waldorf Astoria Orlando</a>
                            </li>
                            <li><a href="https://disneyworld.disney.go.com/events-tours/holidays/" target="_blank"
                                    class="text-blue-600 hover:text-blue-800 font-medium">Disney Christmas Events
                                    Info</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. ITINERARY & SPREADSHEET TAB -->
        <div id="tab-itinerary" class="tab-content hidden">
            <h2 class="text-2xl font-bold text-red-700 mb-4">Trip Itinerary</h2>
            <p class="text-sm text-gray-600 mb-4">Click to edit Activity or Status. Click a checkmark column to commit
                to an activity. Drag rows to reorder or move between days!</p>

            <!-- Top Scrollbar Container -->
            <div id="top-scroll-container" class="overflow-x-auto mb-1">
                <div id="top-scroll-content" class="h-1"></div>
            </div>

            <div id="itinerary-table-container" class="overflow-x-auto rounded-lg shadow-lg">
                <table id="itinerary-table" class="min-w-full bg-white border-collapse">
                    <thead>
                        <tr class="bg-red-600 text-white text-sm uppercase tracking-wider sticky top-0 z-10">
                            <th id="th-date" class="p-3 border-r border-red-700 w-32 resizable-th">
                                Date
                                <div class="resizer" data-column="date"></div>
                            </th>
                            <th id="th-activity" class="p-3 border-r border-red-700 w-48 resizable-th">
                                Activity / Time
                                <div class="resizer" data-column="activity"></div>
                            </th>
                            <th id="th-status" class="p-3 border-r border-red-700 w-24 resizable-th">
                                Status
                                <div class="resizer" data-column="status"></div>
                            </th>
                            <!-- Family Members Columns -->
                            <th class="p-3 border-r border-red-700 text-center">Marc (43)</th>
                            <th class="p-3 border-r border-red-700 text-center">Melissa (39)</th>
                            <th class="p-3 border-r border-red-700 text-center">Billie (10)</th>
                            <th class="p-3 border-r border-red-700 text-center">Mimi (6)</th>
                            <th class="p-3 border-r border-red-700 text-center">Dan (39)</th>
                            <th class="p-3 border-r border-red-700 text-center">Jess (37)</th>
                            <th class="p-3 border-r border-red-700 text-center">Joey (5)</th>
                            <th class="p-3 border-r border-red-700 text-center">Emma (7)</th>
                            <th class="p-3 border-r border-red-700 text-center">Riley (1)</th>
                            <th class="p-3 border-r border-red-700 text-center">John (71)</th>
                            <th class="p-3 border-r border-red-700 text-center">Lindsay (70)</th>
                            <th class="p-3 border-r border-red-700 text-center">Ricky (41)</th>
                        </tr>
                    </thead>
                    <tbody id="itinerary-table-body" class="text-gray-700">
                        <!-- Itinerary Rows will be dynamically added here by JavaScript -->
                    </tbody>
                </table>
            </div>

            <button id="add-item-button" onclick="addItineraryRow()" disabled
                class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md flex items-center disabled:opacity-50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 1 011-1z"
                        clip-rule="evenodd" />
                </svg>
                Add New Idea (TBC)
            </button>
            <p id="add-item-status" class="mt-2 text-sm text-red-500 hidden">Please wait for the app to connect before
                adding items.</p>
        </div>

        <!-- 3. PACKING LIST TAB -->
        <div id="tab-packing" class="tab-content hidden">
            <h2 class="text-2xl font-bold text-red-700 mb-4">Family Packing Lists üß≥</h2>
            <p class="text-sm text-gray-600 mb-4">Add items for each person. Check them off as you pack! (Real-time
                sync)</p>

            <div id="packing-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Packing cards will be dynamically added here -->
                <div class="text-center col-span-full py-8 text-gray-500">Loading packing lists...</div>
            </div>
        </div>

        <!-- 4. GROUP CHAT & SUGGESTIONS TAB -->
        <div id="tab-chat" class="tab-content hidden">
            <h2 class="text-2xl font-bold text-red-700 mb-4">Group Suggestion Box & Chat</h2>

            <div class="bg-gray-100 p-4 rounded-xl shadow-inner mb-4 chat-container" id="chat-messages">
                <p class="text-center text-gray-500">Loading real-time suggestions...</p>
            </div>

            <div class="bg-white p-4 rounded-xl shadow-lg border">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Send a Message or Suggestion</h3>
                <textarea id="chat-input"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500"
                    rows="3" placeholder="Type your idea or question here..."></textarea>
                <button onclick="sendMessage()"
                    class="mt-3 w-full md:w-auto bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg transition duration-150 shadow-md">
                    Submit Suggestion
                </button>
            </div>
        </div>

        <!-- 4. CUSTOM GPT PLANNER TAB -->
        <div id="tab-gpt" class="tab-content hidden">
            <h2 class="text-2xl font-bold text-red-700 mb-4">Mickey's Planning Pal üß†</h2>
            <p class="text-base text-gray-600 mb-4">Ask our custom AI planner for ideas, tips, or facts about our
                Orlando Christmas trip. The Pal is a Disney expert!</p>

            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Chat Window -->
                <div class="lg:w-2/3 bg-white p-5 rounded-xl shadow-lg border">
                    <div id="gpt-chat-log" class="chat-container bg-gray-50 p-4 rounded-lg mb-4 h-96">
                        <div class="text-center text-gray-500 py-4">
                            <p class="font-bold text-red-600">Mickey's Planning Pal</p>
                            <p>Hello! I'm here to help you plan the most magical family Christmas in Orlando. Ask me
                                anything!</p>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="mb-2">
                        <details class="text-xs text-gray-500 mb-2 cursor-pointer">
                            <summary>‚öôÔ∏è Settings (API Key)</summary>
                            <div class="mt-2 p-2 bg-gray-100 rounded border border-gray-300">
                                <label for="gemini-api-key" class="block font-bold mb-1">Google Gemini API Key:</label>
                                <input type="password" id="gemini-api-key"
                                    class="w-full p-2 border border-gray-300 rounded mb-1"
                                    placeholder="Paste your API Key here">
                                <p class="text-[10px] text-gray-400">Key is saved in your browser's local storage.</p>
                                <button onclick="saveApiKey()"
                                    class="mt-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded text-xs">Save
                                    Key</button>
                            </div>
                        </details>
                    </div>
                    <div class="flex space-x-3">
                        <input type="text" id="gpt-input"
                            class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500"
                            placeholder="Ask a question about the trip...">
                        <button id="gpt-send-button" onclick="sendGptQuery()"
                            class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 disabled:opacity-50">
                            Ask Pal
                        </button>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="lg:w-1/3 bg-yellow-100 p-5 rounded-xl shadow-md border border-yellow-300">
                    <h3 class="text-xl font-bold text-yellow-800 mb-3">Grounding Sources</h3>
                    <div id="gpt-sources" class="text-sm text-yellow-700 space-y-2">
                        <p>Sources for the Pal's advice will appear here.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- LOGIN MODAL -->
    <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-95 z-50 flex items-center justify-center hidden">
        <div
            class="bg-white rounded-2xl shadow-2xl p-8 max-w-4xl w-full mx-4 border-4 border-red-600 relative overflow-hidden">
            <!-- Decorative Background -->
            <div class="absolute top-0 left-0 w-full h-4 bg-gradient-to-r from-red-500 via-yellow-400 to-red-500"></div>

            <div class="text-center mb-8">
                <h2 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-2">Who are you? ü§î</h2>
                <p class="text-gray-600 text-lg">Tap your name to enter the planning hub!</p>
            </div>

            <div id="login-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                <!-- Buttons injected by JS -->
            </div>

            <div class="mt-8 text-center">
                <p class="text-xs text-gray-400">This helps us personalize your packing list and chat!</p>
            </div>
        </div>
    </div>

    <!-- App Logic (Standard Script, No Module) -->
    <script src="app.js"></script>
</body>

</html>